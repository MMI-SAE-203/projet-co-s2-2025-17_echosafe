---
import Layout from "../../layouts/Layout.astro";
import LegalNav from "../../components/LegalNav.astro";
---

<Layout>
  <div class="min-h-screen py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto bg-white rounded-lg p-8">
      <h1 class="font-secondary text-3xl font-bold text-center mb-2">
        Politique de Cookies
      </h1>

      <div class="prose prose-slate max-w-none">
        <p class="text-sm text-center mb-8">
          Dernière mise à jour : 30 avril 2025
        </p>

        <LegalNav currentPage="/legal/politique-cookies" />

        <section class="mb-8">
          <h2 class="font-secondary text-2xl font-semibold mb-4">
            1. Qu'est-ce qu'un cookie ?
          </h2>
          <p class="mb-4">
            Un cookie est un petit fichier texte placé sur votre ordinateur,
            tablette ou smartphone lorsque vous visitez un site web. Les cookies
            sont largement utilisés pour permettre le fonctionnement des sites
            web ou pour les rendre plus efficaces, ainsi que pour fournir des
            informations aux propriétaires du site.
          </p>
        </section>

        <section class="mb-8">
          <h2 class="font-secondary text-2xl font-semibold mb-4">
            2. Les cookies que nous utilisons
          </h2>

          <h3 class="text-xl font-medium mb-2">
            2.1. Cookies strictement nécessaires
          </h3>
          <p class="mb-4">
            Ces cookies sont essentiels au fonctionnement de notre site et vous
            permettent de naviguer et d'utiliser les fonctionnalités de base.
            Sans ces cookies, notre site ne peut pas fonctionner correctement.
          </p>
          <table class="w-full border-collapse mb-4">
            <thead>
              <tr class="bg-[#E6E2FF]">
                <th class="border p-2 text-left">Nom du cookie</th>
                <th class="border p-2 text-left">Finalité</th>
                <th class="border p-2 text-left">Durée de conservation</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="border p-2">essential-cookies</td>
                <td class="border p-2"
                  >Nécessaire au fonctionnement de l'application</td
                >
                <td class="border p-2">365 jours</td>
              </tr>
              <tr>
                <td class="border p-2">cookies-preferences-set</td>
                <td class="border p-2"
                  >Mémorise vos préférences en matière de cookies</td
                >
                <td class="border p-2">365 jours</td>
              </tr>
            </tbody>
          </table>

          <h3 class="text-xl font-medium mb-2">2.2. Cookies fonctionnels</h3>
          <p class="mb-4">
            Ces cookies permettent à notre site de mémoriser les choix que vous
            avez faits et de fournir des fonctionnalités améliorées et
            personnalisées, comme votre suivi d'humeur, vos streaks et vos
            objectifs personnels.
          </p>
          <table class="w-full border-collapse mb-4">
            <thead>
              <tr class="bg-[#E6E2FF]">
                <th class="border p-2 text-left">Nom du cookie</th>
                <th class="border p-2 text-left">Finalité</th>
                <th class="border p-2 text-left">Durée de conservation</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="border p-2">functional-cookies</td>
                <td class="border p-2"
                  >Active les fonctionnalités personnalisées</td
                >
                <td class="border p-2">365 jours</td>
              </tr>
              <tr>
                <td class="border p-2">mood-tracker</td>
                <td class="border p-2"
                  >Stocke les préférences de suivi d'humeur</td
                >
                <td class="border p-2">90 jours</td>
              </tr>
              <tr>
                <td class="border p-2">user-goals</td>
                <td class="border p-2">Mémorise vos objectifs et progrès</td>
                <td class="border p-2">180 jours</td>
              </tr>
            </tbody>
          </table>

          <h3 class="text-xl font-medium mb-2">2.3. Cookies analytiques</h3>
          <p class="mb-4">
            Ces cookies nous aident à comprendre comment les visiteurs
            interagissent avec notre site en collectant et en rapportant des
            informations de manière anonyme. Ils nous permettent d'améliorer
            constamment notre plateforme.
          </p>
          <table class="w-full border-collapse mb-4">
            <thead>
              <tr class="bg-[#E6E2FF]">
                <th class="border p-2 text-left">Nom du cookie</th>
                <th class="border p-2 text-left">Finalité</th>
                <th class="border p-2 text-left">Durée de conservation</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="border p-2">analytics-cookies</td>
                <td class="border p-2"
                  >Active la collecte de données analytiques</td
                >
                <td class="border p-2">365 jours</td>
              </tr>
              <tr>
                <td class="border p-2">_ga</td>
                <td class="border p-2"
                  >Cookie Google Analytics pour distinguer les utilisateurs</td
                >
                <td class="border p-2">2 ans</td>
              </tr>
              <tr>
                <td class="border p-2">_gid</td>
                <td class="border p-2"
                  >Cookie Google Analytics pour suivre les sessions</td
                >
                <td class="border p-2">24 heures</td>
              </tr>
            </tbody>
          </table>
        </section>

        <section class="mb-8">
          <h2 class="font-secondary text-2xl font-semibold mb-4">
            3. Comment gérer vos cookies
          </h2>
          <p class="mb-4">
            Vous pouvez configurer vos préférences de cookies directement
            ci-dessous ou via le menu "Confidentialité" dans la navigation.
          </p>

          <div
            class="mt-8 p-6 border border-primary/20 rounded-lg bg-indigo-50/50"
          >
            <h3 class="text-xl font-bold font-secondary mb-4 text-primary">
              Vos préférences de cookies
            </h3>

            <div
              class="mb-4 p-4 border border-gray-200 rounded-lg bg-white shadow-sm"
            >
              <div class="flex items-center justify-between">
                <div>
                  <h4 class="font-semibold">Cookies strictement nécessaires</h4>
                  <p class="text-sm">
                    Ces cookies sont indispensables au fonctionnement du site et
                    ne peuvent pas être désactivés.
                  </p>
                </div>
                <div class="ml-4">
                  <span class="px-2 py-1 bg-primary/10 text-xs rounded-full"
                    >Obligatoires</span
                  >
                </div>
              </div>
            </div>

            <div
              class="mb-4 p-4 border border-gray-200 rounded-lg bg-white shadow-sm"
            >
              <div class="flex items-center justify-between">
                <div>
                  <h4 class="font-semibold">Cookies fonctionnels</h4>
                  <p class="text-sm">
                    Permettent les fonctionnalités personnalisées comme le
                    Moodtracker, les Streaks et le système de récompenses.
                  </p>
                </div>
                <div class="ml-4">
                  <label
                    class="relative inline-flex items-center cursor-pointer"
                  >
                    <input
                      type="checkbox"
                      id="inline-functional-cookies"
                      class="sr-only peer"
                      checked
                    />
                    <div
                      class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/30 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"
                    >
                    </div>
                  </label>
                </div>
              </div>
            </div>

            <div
              class="mb-6 p-4 border border-gray-200 rounded-lg bg-white shadow-sm"
            >
              <div class="flex items-center justify-between">
                <div>
                  <h4 class="font-semibold">Cookies analytiques</h4>
                  <p class="text-sm">
                    Nous aident à comprendre comment vous utilisez l'application
                    pour l'améliorer.
                  </p>
                </div>
                <div class="ml-4">
                  <label
                    class="relative inline-flex items-center cursor-pointer"
                  >
                    <input
                      type="checkbox"
                      id="inline-analytics-cookies"
                      class="sr-only peer"
                    />
                    <div
                      class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/30 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"
                    >
                    </div>
                  </label>
                </div>
              </div>
            </div>

            <div class="flex flex-col sm:flex-row gap-3 justify-center">
              <button
                id="reject-all-inline"
                class="hover:cursor-pointer order-2 sm:order-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-3xl hover:bg-gray-100 transition duration-300"
              >
                Tout refuser
              </button>
              <button
                id="save-preferences-inline"
                class="hover:cursor-pointer order-1 sm:order-2 px-6 py-3 bg-primary text-white rounded-3xl border border-primary hover:bg-white hover:text-primary transition duration-300"
              >
                Enregistrer mes préférences
              </button>
              <button
                id="accept-all-inline"
                class="hover:cursor-pointer order-3 px-6 py-3 bg-primary text-white rounded-3xl border border-primary hover:bg-white hover:text-primary transition duration-300"
              >
                Tout accepter
              </button>
            </div>

            <p class="mt-4 text-sm text-center">
              Vos préférences seront sauvegardées pendant 365 jours
            </p>
          </div>

          <p class="mt-6">
            Vous pouvez également supprimer les cookies directement depuis votre
            navigateur. Pour en savoir plus sur la façon de supprimer ou de
            bloquer les cookies, consultez l'aide de votre navigateur.
          </p>
        </section>

        <section class="mb-8">
          <h2 class="font-secondary text-2xl font-semibold mb-4">
            4. Cookies tiers et partage de données
          </h2>

          <p class="mb-4">
            Dans un souci de transparence totale, voici les services tiers avec
            lesquels nous travaillons :
          </p>

          <div class="overflow-x-auto">
            <table class="w-full border-collapse mb-4">
              <thead>
                <tr class="bg-[#E6E2FF]">
                  <th class="border p-2 text-left">Service</th>
                  <th class="border p-2 text-left">Utilisation</th>
                  <th class="border p-2 text-left">Données partagées</th>
                  <th class="border p-2 text-left"
                    >Politique de confidentialité</th
                  >
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="border p-2">Google Analytics</td>
                  <td class="border p-2">Analyse d'audience et comportement</td>
                  <td class="border p-2"
                    >Pages visitées, durée de visite, données de navigation
                    (anonymisées)</td
                  >
                  <td class="border p-2"
                    ><a
                      href="https://policies.google.com/privacy"
                      class="text-primary hover:underline">Voir</a
                    ></td
                  >
                </tr>
                <tr>
                  <td class="border p-2">Formspree</td>
                  <td class="border p-2"
                    >Traitement des formulaires de contact</td
                  >
                  <td class="border p-2"
                    >Nom, email et contenu des messages que vous envoyez</td
                  >
                  <td class="border p-2"
                    ><a
                      href="https://formspree.io/legal/privacy-policy/"
                      class="text-primary hover:underline">Voir</a
                    ></td
                  >
                </tr>
                <tr>
                  <td class="border p-2">Vercel Analytics</td>
                  <td class="border p-2"
                    >Performance et disponibilité du site</td
                  >
                  <td class="border p-2"
                    >Données de performance, erreurs techniques (sans données
                    personnelles)</td
                  >
                  <td class="border p-2"
                    ><a
                      href="https://vercel.com/legal/privacy-policy"
                      class="text-primary hover:underline">Voir</a
                    ></td
                  >
                </tr>
              </tbody>
            </table>
          </div>

          <div class="bg-amber-50 border-l-4 border-amber-500 p-4 rounded-r-lg">
            <p class="font-bold">Important :</p>
            <p>Nous n'utilisons jamais vos données pour :</p>
            <ul class="list-disc pl-5">
              <li>La vente à des tiers</li>
              <li>Le ciblage publicitaire</li>
              <li>Le suivi entre différents sites web</li>
            </ul>
          </div>
        </section>

        <section class="mb-8">
          <h2 class="font-secondary text-2xl font-semibold mb-4">
            Utilisation détaillée de vos données
          </h2>

          <p class="mb-4">
            Nous tenons à être totalement transparents sur l'utilisation que
            nous faisons de vos données. Voici précisément ce que nous
            collectons et pourquoi :
          </p>

          <div class="space-y-4">
            <div
              class="p-4 border-l-4 border-primary bg-indigo-50 rounded-r-lg"
            >
              <h3 class="font-bold text-lg mb-2">
                Pour le fonctionnement du site
              </h3>
              <ul class="list-disc pl-5 space-y-1">
                <li>Identifiant de session (pour maintenir votre connexion)</li>
                <li>
                  Préférences d'affichage (mode clair/sombre, taille de police)
                </li>
                <li>
                  État d'acceptation des cookies (pour respecter vos choix)
                </li>
              </ul>
            </div>

            <div class="p-4 border-l-4 border-blue-400 bg-blue-50 rounded-r-lg">
              <h3 class="font-bold text-lg mb-2">
                Pour les fonctionnalités personnalisées
              </h3>
              <ul class="list-disc pl-5 space-y-1">
                <li>
                  Vos enregistrements d'humeur (date, niveau, facteurs associés)
                </li>
                <li>Votre progression et objectifs personnels</li>
                <li>Vos préférences de notifications</li>
                <li>Ces données ne sont jamais partagées avec des tiers</li>
              </ul>
            </div>

            <div
              class="p-4 border-l-4 border-amber-400 bg-amber-50 rounded-r-lg"
            >
              <h3 class="font-bold text-lg mb-2">
                Pour l'amélioration du service
              </h3>
              <ul class="list-disc pl-5 space-y-1">
                <li>
                  Pages visitées et temps passé (pour améliorer l'ergonomie)
                </li>
                <li>
                  Interactions avec l'interface (boutons cliqués, formulaires
                  remplis)
                </li>
                <li>
                  Données de performance (temps de chargement, erreurs
                  rencontrées)
                </li>
                <li>Ces données sont anonymisées avant analyse</li>
              </ul>
            </div>
          </div>
        </section>
      </div>

      <div class="mt-10 text-center">
        <div class="flex flex-wrap justify-center gap-3 mb-4">
          <a
            href="/legal/politique-confidentialite"
            class="inline-block px-4 py-2 border border-primary text-primary rounded-3xl hover:bg-primary hover:text-white transition duration-300 text-sm"
          >
            Politique de confidentialité
          </a>
          <a
            href="/legal/conditions"
            class="inline-block px-4 py-2 border border-primary text-primary rounded-3xl hover:bg-primary hover:text-white transition duration-300 text-sm"
          >
            Conditions d'utilisation
          </a>
          <a
            href="/legal/politique-cookies"
            class="inline-block px-4 py-2 border border-primary text-primary rounded-3xl hover:bg-primary hover:text-white transition duration-300 text-sm"
          >
            Politique de cookies
          </a>
        </div>
        <button
          id="scroll-to-top"
          class="hover:cursor-pointer inline-flex items-center justify-center p-3 bg-primary text-white rounded-full shadow-lg hover:bg-white hover:text-primary border transition-all duration-300 focus:outline-none"
          aria-label="Remonter en haut de la page"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {

      function setCookie(name, value, days) {
        const d = new Date();
        d.setTime(d.getTime() + days * 24 * 60 * 60 * 1000);
        const expires = "expires=" + d.toUTCString();
        document.cookie = name + "=" + value + ";" + expires + ";path=/";

        const event = new CustomEvent("cookieChange", {
          detail: { name, value },
        });
        document.dispatchEvent(event);
      }

      function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(";");
        for (let i = 0; i < ca.length; i++) {
          let c = ca[i];
          while (c.charAt(0) === " ") c = c.substring(1);
          if (c.indexOf(nameEQ) === 0)
            return c.substring(nameEQ.length, c.length);
        }
        return "";
      }

      const scrollToTopButton = document.getElementById("scroll-to-top");

      if (scrollToTopButton) {
        scrollToTopButton.addEventListener("click", function () {
          window.scrollTo({
            top: 0,
            behavior: "smooth",
          });
        });
      }

      function saveCookiePreferences(essential, functional, analytics) {
        setCookie("essential-cookies", "true", 365);

        setCookie("functional-cookies", functional.toString(), 365);
        setCookie("analytics-cookies", analytics.toString(), 365);

        setCookie("cookies-preferences-set", "true", 365);

        if (!functional) {
          document.cookie =
            "mood-tracker=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
          document.cookie =
            "user-goals=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        }

        if (!analytics) {
          document.cookie =
            "_ga=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
          document.cookie =
            "_gid=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        }

        updateAllToggles();
      }

      function updateAllToggles() {
        const allFunctionalToggles = document.querySelectorAll(
          '[id*="functional-cookies"]'
        );
        allFunctionalToggles.forEach((toggle) => {
          toggle.checked = getCookie("functional-cookies") !== "false";
        });

        const allAnalyticsToggles = document.querySelectorAll(
          '[id*="analytics-cookies"]'
        );
        allAnalyticsToggles.forEach((toggle) => {
          toggle.checked = getCookie("analytics-cookies") === "true";
        });
      }

      function showConfirmationMessage(parentElement, type, message) {
        const confirmationMessage = document.createElement("div");
        confirmationMessage.className = `mt-4 p-3 bg-${type}-100 text-${type}-800 rounded-lg text-center`;
        confirmationMessage.textContent = message;

        parentElement.after(confirmationMessage);

        setTimeout(function () {
          confirmationMessage.style.opacity = "0";
          confirmationMessage.style.transition = "opacity 1s";
          setTimeout(function () {
            confirmationMessage.remove();
          }, 1000);
        }, 3000);
      }

      const cookieBanner = document.getElementById("cookie-banner");
      if (cookieBanner && getCookie("cookies-preferences-set") !== "true") {
        cookieBanner.style.display = "block";
      }

      const functionalToggle = document.getElementById(
        "inline-functional-cookies"
      );
      const analyticsToggle = document.getElementById(
        "inline-analytics-cookies"
      );

      if (functionalToggle) {
        functionalToggle.checked = getCookie("functional-cookies") !== "false"; 
      }

      if (analyticsToggle) {
        analyticsToggle.checked = getCookie("analytics-cookies") === "true"; 
      }

      document.addEventListener("cookieChange", function (e) {
        updateAllToggles();
      });

      const saveButton = document.getElementById("save-preferences-inline");
      if (saveButton) {
        saveButton.addEventListener("click", function () {
          saveCookiePreferences(
            true, 
            functionalToggle.checked,
            analyticsToggle.checked
          );

          showConfirmationMessage(
            saveButton.parentNode,
            "green",
            "Vos préférences ont été enregistrées avec succès !"
          );
        });
      }

      const acceptAllButton = document.getElementById("accept-all-inline");
      if (acceptAllButton) {
        acceptAllButton.addEventListener("click", function () {
          if (functionalToggle) functionalToggle.checked = true;
          if (analyticsToggle) analyticsToggle.checked = true;

          saveCookiePreferences(true, true, true);

          showConfirmationMessage(
            acceptAllButton.parentNode,
            "green",
            "Tous les cookies ont été acceptés !"
          );
        });
      }

      const rejectAllButton = document.getElementById("reject-all-inline");
      if (rejectAllButton) {
        rejectAllButton.addEventListener("click", function () {
          if (functionalToggle) functionalToggle.checked = false;
          if (analyticsToggle) analyticsToggle.checked = false;

          saveCookiePreferences(true, false, false);

          showConfirmationMessage(
            rejectAllButton.parentNode,
            "blue",
            "Seuls les cookies essentiels sont activés."
          );
        });
      }

      const cookiePreferencesButton = document.getElementById(
        "cookie-preferences-button"
      );
      if (cookiePreferencesButton && cookieBanner) {
        cookiePreferencesButton.addEventListener("click", function () {
          const functionalCheckbox =
            document.getElementById("functional-cookies");
          const analyticsCheckbox =
            document.getElementById("analytics-cookies");

          if (functionalCheckbox) {
            functionalCheckbox.checked =
              getCookie("functional-cookies") !== "false";
          }

          if (analyticsCheckbox) {
            analyticsCheckbox.checked =
              getCookie("analytics-cookies") === "true";
          }

          cookieBanner.style.display = "block";
          cookieBanner.scrollIntoView({ behavior: "smooth" });
        });
      }

      const allCookiePreferencesLinks = document.querySelectorAll(
        ".cookie-preferences-link"
      );
      allCookiePreferencesLinks.forEach((link) => {
        link.addEventListener("click", function (e) {
          e.preventDefault();
          if (cookieBanner) {
            cookieBanner.style.display = "block";
            cookieBanner.scrollIntoView({ behavior: "smooth" });
          } else {
            window.location.href = "/legal/politique-cookies";
          }
        });
      });

      if (!(window as any).CookieUtils) {
        (window as any).CookieUtils = {
          setCookie,
          getCookie,
          savePreferences: saveCookiePreferences, 
          updateToggles: updateAllToggles, 
        };
      }
    });
  </script>
</Layout>
