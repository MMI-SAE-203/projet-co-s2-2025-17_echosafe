---
import Layout from "../layouts/Layout.astro";
import "../style/global.css";
import Hero from "../components/Hero.astro";
import Card_accueil from "../components/Card_accueil.astro";
import TemoignageCard from "../components/TemoignageCard.astro";
import FAQItem from "../components/FAQItem.astro";
import { Image } from "astro:assets";

// Importation des images
import maquetteMessage from "../assets/maquette_accueil/maquette_message.webp";
import maquetteHumeur from "../assets/maquette_accueil/maquette_humeur.webp";
import maquetteKitSecours from "../assets/maquette_accueil/maquette_kit-de-secours.webp";
import hommeSecurite from "../assets/homme-securite.webp";
import femmeTemoignage from "../assets/femme-temoignage.webp";
import hommeFAQ from "../assets/homme-FAQ.webp";

const testimonials = [
  {
    name: "Marie D.",
    rating: 5,
    content:
      "Grâce aux canaux anonymes, j'ai pu partager mes expériences et recevoir un soutien immédiat. La partie personnalisée m'a vraiment aidée.",
  },
  {
    name: "Alexandre M.",
    rating: 5,
    content:
      "La modération et la sécurité des communications sur Echo Safe me permettent de discuter librement sans crainte pour ma confidentialité.",
  },
  {
    name: "Sophie L.",
    rating: 5,
    content:
      "Le Kit de Secours est essentiel. Avoir accès aux numéros d'urgence et conseils pratiques me rassure. L'application est facile à utiliser.",
  },
  {
    name: "Julien C.",
    rating: 5,
    content:
      "Echo Safe est une vraie communauté. J'ai trouvé un soutien incroyable grâce aux discussions anonymes et personnalisées.",
  },
  {
    name: "Émilie T.",
    rating: 5,
    content:
      "L'anonymat et la bienveillance de la communauté m'ont permis de m'ouvrir et de trouver des solutions à mes problèmes.",
  },
  {
    name: "Thomas B.",
    rating: 5,
    content:
      "Le suivi d'humeur m'aide à identifier mes déclencheurs et à mieux gérer mon anxiété quotidienne.",
  },
  {
    name: "Laura M.",
    rating: 5,
    content:
      "Les ressources et conseils personnalisés sont vraiment adaptés à ma situation et m'aident à progresser.",
  },
  {
    name: "Nicolas P.",
    rating: 5,
    content:
      "Excellent équilibre entre soutien professionnel et communautaire. Une aide de qualité disponible en permanence.",
  },
];

const topRowTestimonials = testimonials.slice(0, 4);
const bottomRowTestimonials = testimonials.slice(4, 8);

const preloadTestimonials = testimonials.slice(0, 2);
---

<Layout>
  <Hero />
  <section class="container mx-auto px-4 py-8">
    <div class="flex flex-col justify-center items-center">
      <h2
        class="font-secondary text-3xl md:text-5xl font-bold text-center mb-10"
      >
        Des outils concrets pour surmonter le harcèlement
      </h2>
    </div>

    <Card_accueil
      title="Espaces de soutien et de partage"
      description="Rejoignez notre communauté pour échanger anonymement avec des professionnels et d'autres membres dans un environnement sécurisé."
      buttonText="Découvrir l'outil"
      buttonLink="#"
      imageUrl={maquetteMessage.src}
      bgColor="bg-pink-100"
      imagePosition="right"
      layout="horizontal"
      bgGradient="bg-gradient-to-r from-[#FFE3FA] to-[#FF9CED]"
      loading="lazy"
      width="400"
      height="300"
    />

    <Card_accueil
      title="Suivi votre humeur"
      description="Enregistrez vos humeurs avec le Moodtracker et recevez des conseils personnalisés pour améliorer votre bien-être."
      buttonText="Suivre votre humeur"
      buttonLink="#"
      imageUrl={maquetteHumeur.src}
      bgColor="bg-orange-200"
      bgGradient="bg-gradient-to-r from-[#FFDEDE] to-[#EDA8A8]"
      imagePosition="left"
      layout="horizontal"
      loading="lazy"
      width="400"
      height="300"
    />

    <Card_accueil
      title="Kit de secours contre le harcèlement"
      description="Accédez aux ressources essentielles : numéros d'urgence, conseils pratiques et soutien immédiat contre le harcèlement."
      buttonText="Découvrir le kit"
      buttonLink="#"
      imageUrl={maquetteKitSecours.src}
      bgColor="bg-blue-100"
      bgGradient="bg-gradient-to-r from-[#E2EEFF] to-[#7CA7E5]"
      imagePosition="right"
      layout="horizontal"
      loading="lazy"
      width="400"
      height="300"
    />
  </section>

  <section class="w-full bg-gradient-to-b from-[#323F92] to-[#121D64] py-16">
    <div class="max-w-6xl mx-auto px-4">
      <h2
        class="font-secondary text-white text-3xl md:text-5xl font-bold text-center mb-10"
      >
        Un accompagnement motivant<br />et adapté à votre rythme
      </h2>

      <div class="flex flex-col md:flex-row justify-center gap-8">
        <Card_accueil
          title="Plan de suivi personnalisé"
          description="Un parcours adapté à votre situation avec des ressources et du soutien pour avancer à votre rythme."
          buttonText="Découvrir"
          buttonLink="#"
          bgColor="bg-white"
          layout="horizontal"
          loading="lazy"
        />
        <Card_accueil
          title="Défis et récompenses"
          description="Restez motivé avec notre système de badges et de défis quotidiens pour célébrer chaque progrès."
          buttonText="Défis & récompenses"
          buttonLink="#"
          bgColor="bg-white"
          layout="horizontal"
          loading="lazy"
        />
      </div>
    </div>
  </section>

  <section class="relative py-10 px-4">
    <div class="relative flex flex-col items-center mb-10 z-10">
      <h2
        class="relative text-3xl md:text-4xl font-bold font-secondary text-center z-10 bg-white/70 px-4 py-2 rounded-lg"
      >
        Une application pensée pour <br /> votre sécurité
      </h2>
    </div>

    <div class="absolute right-0 md:right-30 -top-15 w-40 z-0">
      <Image
        src={hommeSecurite}
        alt="Sécurité"
        class="w-full h-auto object-cover"
        loading="lazy"
        width={160}
        height={240}
      />
    </div>

    <div class="relative z-10 mx-auto max-w-7xl">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <Card_accueil
          title="Protection des communications"
          description="Nous filtrons et modérons les contenus avec des outils avancés pour garantir un environnement sûr et respectueux."
          buttonText="En savoir plus"
          buttonLink="#"
          bgColor="bg-[#cfe1ff]"
          bgGradient="bg-gradient-to-r from-[#E2EEFF] to-[#B1D2FF]"
          layout="vertical"
          loading="lazy"
        />

        <Card_accueil
          title="Infrastructure Sécurisée"
          description="Chiffrement de bout en bout et outils de surveillance pour protéger vos messages et données confidentielles."
          buttonText="En savoir plus"
          buttonLink="#"
          bgColor="bg-[#cfe1ff]"
          bgGradient="bg-gradient-to-r from-[#E2EEFF] to-[#B1D2FF]"
          layout="vertical"
          loading="lazy"
        />

        <div class="md:col-span-2">
          <Card_accueil
            title="Mesures de Sécurité Supplémentaires"
            description="Audits réguliers, tests de sécurité et authentification à deux facteurs pour protéger votre compte et vos informations."
            buttonText="Nos protections"
            buttonLink="#"
            bgColor="bg-[#cfe1ff]"
            bgGradient="bg-gradient-to-r from-[#E2EEFF] to-[#B1D2FF]"
            layout="vertical"
            loading="lazy"
          />
        </div>
      </div>
    </div>
  </section>

  <section>
    <div class="flex justify-center items-center gap-2 mb-4">
      <svg
        class="w-5 h-5 text-yellow-400"
        viewBox="0 0 24 24"
        fill="currentColor"
      >
        <path
          d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
        ></path>
      </svg>
      <span class="text-sm font-medium">4.8/5 sur 10k avis</span>
    </div>

    <div class="relative flex flex-col items-center mb-10">
      <div
        class="absolute left-0 md:left-30 top-1/2 transform -translate-y-1/2 w-40 z-0"
      >
        <Image
          src={femmeTemoignage}
          alt="Témoignage"
          class="w-full h-auto object-cover"
          loading="lazy"
          width={160}
          height={240}
        />
      </div>

      <h2
        class="relative text-3xl md:text-4xl font-bold font-secondary text-center z-10 bg-white/70 px-4 py-2 rounded-lg"
      >
        Témoignages d'utilisateurs
      </h2>
    </div>

    <div
      class="relative bg-gradient-to-b from-[#FFDEDE] to-[#FFB3B3] py-16 overflow-hidden"
    >
      <div id="testimonials-container" class="w-full overflow-hidden">
        <div class="flex w-full gap-x-4 top-row">
          {
            topRowTestimonials.map((testimonial) => (
              <div class="min-w-[280px] md:min-w-[320px] flex-shrink-0 w-full md:w-[calc(50%-12px)]">
                <TemoignageCard
                  name={testimonial.name}
                  rating={testimonial.rating}
                  content={testimonial.content}
                  loading="lazy"
                />
              </div>
            ))
          }
        </div>

        <div class="flex w-full gap-x-4 mt-8 bottom-row">
          {
            bottomRowTestimonials.map((testimonial) => (
              <div class="min-w-[280px] md:min-w-[320px] flex-shrink-0 w-full md:w-[calc(50%-12px)]">
                <TemoignageCard
                  name={testimonial.name}
                  rating={testimonial.rating}
                  content={testimonial.content}
                  loading="lazy"
                />
              </div>
            ))
          }
        </div>
      </div>
    </div>
  </section>

  <section class="relative py-10 px-4">
    <div class="flex flex-col items-center z-10">
      <h2
        class="relative text-3xl md:text-4xl font-bold font-secondary text-center z-10 bg-white/70 px-4 py-2 rounded-lg"
      >
        FAQ
      </h2>
    </div>

    <div class="absolute right-0 md:right-30 -top-15 w-40 z-0">
      <Image
        src={hommeFAQ}
        alt="FAQ"
        class="w-full h-auto object-cover"
        loading="lazy"
        width={160}
        height={240}
      />
    </div>

    <div class="relative z-10 mx-auto max-w-6xl">
      <FAQItem />
    </div>
  </section>

  <div
    id="cookie-banner"
    class="fixed bottom-0 left-0 right-0 bg-white p-6 md:p-10 shadow-2xl max-h-[90vh] overflow-y-auto z-50 w-full md:max-w-4xl md:mx-auto md:left-1/2 md:transform md:-translate-x-1/2 md:rounded-t-2xl hidden"
  >
    <h2 class="text-2xl font-semibold mb-4">Paramètres de confidentialité</h2>

    <p class="mb-4 text-sm">
      Cette application utilise des cookies pour différentes finalités.
    </p>

    <div class="mb-4 p-3 border border-gray-200 rounded-lg">
      <div class="flex items-center justify-between">
        <div>
          <h3 class="font-semibold">Cookies nécessaires</h3>
          <p class="text-sm text-gray-600">
            Indispensables au fonctionnement du site.
          </p>
        </div>
        <div class="ml-4">
          <span class="px-2 py-1 bg-gray-200 text-gray-800 text-xs rounded-full"
            >Obligatoires</span
          >
        </div>
      </div>
    </div>

    <div class="mb-4 p-3 border border-gray-200 rounded-lg">
      <div class="flex items-center justify-between">
        <div>
          <h3 class="font-semibold">Cookies fonctionnels</h3>
          <p class="text-sm text-gray-600">
            Pour les fonctionnalités personnalisées.
          </p>
        </div>
        <div class="ml-4">
          <label class="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              id="functional-cookies"
              class="sr-only peer"
              checked
            />
            <div
              class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"
            >
            </div>
          </label>
        </div>
      </div>
    </div>

    <div class="mb-4 p-3 border border-gray-200 rounded-lg">
      <div class="flex items-center justify-between">
        <div>
          <h3 class="font-semibold">Cookies analytiques</h3>
          <p class="text-sm text-gray-600">Pour améliorer l'application.</p>
        </div>
        <div class="ml-4">
          <label class="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              id="analytics-cookies"
              class="sr-only peer"
            />
            <div
              class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"
            >
            </div>
          </label>
        </div>
      </div>
    </div>

    <p class="mb-6 text-sm">
      <a href="/politique-cookies" class="text-blue-600 underline"
        >Politique de confidentialité</a
      >
    </p>

    <div class="flex flex-col sm:flex-row gap-3 justify-center">
      <button
        id="reject-all-cookies"
        class="order-2 sm:order-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-3xl hover:bg-gray-100 transition duration-300"
      >
        Tout refuser
      </button>
      <button
        id="accept-selected-cookies"
        class="order-1 sm:order-2 px-6 py-3 bg-[var(--color-primary)] text-white rounded-3xl hover:bg-blue-700 transition duration-300"
      >
        Accepter la sélection
      </button>
      <button
        id="accept-all-cookies"
        class="order-3 px-6 py-3 bg-green-600 text-white rounded-3xl hover:bg-green-700 transition duration-300"
      >
        Tout accepter
      </button>
    </div>
  </div>
</Layout>

<script is:inline>
  const CookieUtils = {
    savePreferences: function (essential, functional, analytics) {
      const expiryDate = new Date();
      expiryDate.setFullYear(expiryDate.getFullYear() + 1);
      const expires = "; expires=" + expiryDate.toUTCString();

      document.cookie =
        "cookies-preferences-set=true" + expires + "; path=/; SameSite=Lax";
      document.cookie =
        "cookies-essential=" + essential + expires + "; path=/; SameSite=Lax";
      document.cookie =
        "cookies-functional=" + functional + expires + "; path=/; SameSite=Lax";
      document.cookie =
        "cookies-analytics=" + analytics + expires + "; path=/; SameSite=Lax";
    },
    hasMadeChoice: function () {
      return document.cookie.indexOf("cookies-preferences-set=true") > -1;
    },
  };

  function setupTestimonialsAnimation() {
    const container = document.getElementById("testimonials-container");
    if (!container) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const topRow = container.querySelector(".top-row");
            const bottomRow = container.querySelector(".bottom-row");

            if (topRow && !topRow.classList.contains("animated")) {
              topRow.classList.add("animated");
              topRow.style.animation = "scrollLeft 30s linear infinite";
              const content = topRow.innerHTML;
              topRow.innerHTML = content + content;
            }

            if (bottomRow && !bottomRow.classList.contains("animated")) {
              bottomRow.classList.add("animated");
              bottomRow.style.animation = "scrollRight 30s linear infinite";
              const content = bottomRow.innerHTML;
              bottomRow.innerHTML = content + content;
            }

            observer.disconnect();
          }
        });
      },
      { threshold: 0.1 }
    );

    observer.observe(container);
  }

  function setupCookieBanner() {
    if (!CookieUtils.hasMadeChoice()) {
      const cookieBanner = document.getElementById("cookie-banner");
      if (cookieBanner) {
        cookieBanner.classList.remove("hidden");

        document
          .getElementById("accept-all-cookies")
          ?.addEventListener("click", () => {
            CookieUtils.savePreferences(true, true, true);
            cookieBanner.classList.add("hidden");
          });

        document
          .getElementById("accept-selected-cookies")
          ?.addEventListener("click", () => {
            const functional =
              document.getElementById("functional-cookies")?.checked || false;
            const analytics =
              document.getElementById("analytics-cookies")?.checked || false;
            CookieUtils.savePreferences(true, functional, analytics);
            cookieBanner.classList.add("hidden");
          });

        document
          .getElementById("reject-all-cookies")
          ?.addEventListener("click", () => {
            CookieUtils.savePreferences(true, false, false);
            cookieBanner.classList.add("hidden");
          });
      }
    }
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(() => {
        setupTestimonialsAnimation();
        setupCookieBanner();
      }, 100);
    });
  } else {
    setTimeout(() => {
      setupTestimonialsAnimation();
      setupCookieBanner();
    }, 100);
  }
</script>

<style>
  @keyframes scrollLeft {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  @keyframes scrollRight {
    0% {
      transform: translateX(-50%);
    }
    100% {
      transform: translateX(0);
    }
  }
</style>
