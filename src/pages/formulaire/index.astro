---
import Layout from "../../layouts/Layout.astro";
import Formulaire from "../../components/Formulaire.astro";
import PocketBase from "pocketbase";

// Vérifier si l'utilisateur vient de s'inscrire
const isNewUser = Astro.url.searchParams.get("new") === "true";

// Si ce n'est pas un nouvel utilisateur, rediriger vers l'accueil
if (!isNewUser) {
  return Astro.redirect("/accueil-app");
}

// Récupérer l'utilisateur connecté pour ajouter son ID au formulaire
const pb = new PocketBase("https://echosafe.eloishenry.fr");
const authCookie = Astro.request.headers.get("cookie");
let userId = "";

if (authCookie) {
  pb.authStore.loadFromCookie(authCookie);
  if (pb.authStore.isValid) {
    userId = pb.authStore.model.id;
  }
}

// Définir les questions pour le formulaire de harcèlement
const questions = [
  {
    id: 1,
    title: "Avez-vous déjà été victime de harcèlement ?",
    options: ["Oui", "Non", "Préfère ne pas répondre"],
  },
  {
    id: 2,
    title: "Quelle forme de harcèlement avez-vous subie ?",
    options: [
      "Harcèlement verbal",
      "Harcèlement physique",
      "Cyberharcèlement",
      "Harcèlement sexuel",
      "Autre",
      "Préfère ne pas répondre",
    ],
  },
  {
    id: 3,
    title: "Où cela s'est-il produit ?",
    options: [
      "À l'école/université",
      "Au travail",
      "Sur internet",
      "Dans un lieu public",
      "Autre",
      "Préfère ne pas répondre",
    ],
  },
  {
    id: 4,
    title: "Avez-vous cherché de l'aide ?",
    options: [
      "Oui, auprès d'un professionnel",
      "Oui, auprès de proches",
      "Oui, auprès des autorités",
      "Non",
      "Préfère ne pas répondre",
    ],
  },
  {
    id: 5,
    title:
      "Comment vous sentez-vous aujourd'hui par rapport à cette expérience ?",
    options: [
      "Encore traumatisé(e)",
      "En voie de guérison",
      "Résilient(e)",
      "Indifférent(e)",
      "Préfère ne pas répondre",
    ],
  },
];
---

<Layout>
  <div class="min-h-screen py-8">
    <div class="max-w-4xl mx-auto">
      <Formulaire questions={questions} userId={userId} />
    </div>
  </div>
</Layout>
