import { c as createAstro, a as createComponent, m as maybeRenderHead, b as addAttribute, d as renderScript, r as renderTemplate, e as renderComponent, F as Fragment } from './astro/server_DviQv69v.mjs';
import 'kleur/colors';
/* empty css                              */

const $$Astro = createAstro("https://echosafe.eloishenry.fr/");
const $$ChatConversation = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$ChatConversation;
  const {
    conversationId,
    otherUser,
    messages,
    currentUserId,
    isVolunteerChat = false
  } = Astro2.props;
  const isValidConversation = !!conversationId;
  const backUrl = isVolunteerChat ? "/messages/aide" : "/messages/prives";
  return renderTemplate`${maybeRenderHead()}<div class="chat-conversation flex flex-col h-[100vh] sm:h-full bg-gray-50 rounded-lg overflow-hidden shadow-md" data-astro-cid-xbdigaai> <!-- En-tête de conversation --> <div class="flex items-center p-3 sm:p-4 bg-white border-b shadow-sm sticky top-0 z-10" data-astro-cid-xbdigaai> <a${addAttribute(backUrl, "href")} class="p-2 -ml-2 mr-1 sm:mr-2 text-primary hover:bg-gray-100 rounded-full transition-colors sm:hidden" aria-label="Retour" data-astro-cid-xbdigaai> <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" data-astro-cid-xbdigaai> <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" data-astro-cid-xbdigaai></path> </svg> </a> <div class="w-10 h-10 rounded-full bg-gray-200 flex-shrink-0 overflow-hidden" data-astro-cid-xbdigaai> ${otherUser?.avatarUrl ? renderTemplate`<img${addAttribute(otherUser.avatarUrl, "src")} alt="" class="w-full h-full object-cover" data-astro-cid-xbdigaai>` : renderTemplate`<div${addAttribute(`w-full h-full flex items-center justify-center ${isVolunteerChat ? "bg-secondary" : "bg-primary"} text-white text-lg`, "class")} data-astro-cid-xbdigaai> ${otherUser?.pseudo_utilisateur?.charAt(0) || otherUser?.prenom_utilisateur?.charAt(0) || "?"} </div>`} </div> <div class="ml-3 flex-1 min-w-0" data-astro-cid-xbdigaai> <p class="font-medium truncate" data-astro-cid-xbdigaai> ${otherUser?.pseudo_utilisateur || "Utilisateur"} </p> ${isVolunteerChat && renderTemplate`<p class="text-xs text-secondary" data-astro-cid-xbdigaai>Aidant bénévole</p>`} </div> <button id="refresh-messages" class="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full transition-colors" data-astro-cid-xbdigaai> <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-xbdigaai> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" data-astro-cid-xbdigaai></path> </svg> </button> </div> ${!isValidConversation && renderTemplate`<div class="flex-1 flex items-center justify-center bg-gray-50 p-4" data-astro-cid-xbdigaai> <div class="text-center text-gray-500 max-w-md" data-astro-cid-xbdigaai> <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-xbdigaai> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" data-astro-cid-xbdigaai></path> </svg> <h3 class="text-lg font-medium mb-2" data-astro-cid-xbdigaai>Conversation non disponible</h3> <p class="mb-4" data-astro-cid-xbdigaai>La conversation demandée n'existe pas ou a été supprimée.</p> <a href="/messages" class="inline-flex items-center px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90" data-astro-cid-xbdigaai> <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor" data-astro-cid-xbdigaai> <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" data-astro-cid-xbdigaai></path> </svg>
Retour aux messages
</a> </div> </div>`} ${isValidConversation && renderTemplate`${renderComponent($$result, "Fragment", Fragment, { "data-astro-cid-xbdigaai": true }, { "default": async ($$result2) => renderTemplate`  <div id="message-container" class="flex-1 overflow-y-auto p-3 sm:p-4 space-y-2 sm:space-y-3 bg-[#f5f5f5]" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cGF0dGVybiBpZD0iYSIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBwYXR0ZXJuVHJhbnNmb3JtPSJyb3RhdGUoNDUpIj48cGF0aCBkPSJNMjAgMEgwdjIwaDIwVjB6IiBmaWxsPSJyZ2JhKDIyOSwgMjI5LCAyMjksIDAuMikiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNmNWY1ZjUiLz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2EpIi8+PC9zdmc+');" data-astro-cid-xbdigaai> ${messages.length === 0 ? renderTemplate`<div class="flex flex-col items-center justify-center h-full text-center py-8 text-gray-500" data-astro-cid-xbdigaai> <div class="bg-white p-5 sm:p-6 rounded-xl shadow-sm max-w-md" data-astro-cid-xbdigaai> <svg xmlns="http://www.w3.org/2000/svg" class="h-14 sm:h-16 w-14 sm:w-16 text-gray-300 mb-3 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-xbdigaai> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" data-astro-cid-xbdigaai></path> </svg> <p class="font-medium text-lg" data-astro-cid-xbdigaai>Aucun message pour l'instant</p> <p class="text-sm mt-2 mb-4" data-astro-cid-xbdigaai>Commencez la conversation avec ${otherUser?.pseudo_utilisateur || "ce contact"}.</p> <div class="text-center" data-astro-cid-xbdigaai> <span class="inline-block px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-xs" data-astro-cid-xbdigaai>
Écrivez votre message ci-dessous ↓
</span> </div> </div> </div>` : messages.map((message, index) => {
    const isSender = message.sender_id === currentUserId;
    const showAvatar = !isSender && (index === 0 || messages[index - 1]?.sender_id !== message.sender_id);
    const messageTime = new Date(message.created).toLocaleTimeString([], {
      hour: "2-digit",
      minute: "2-digit"
    });
    const isConsecutive = index > 0 && messages[index - 1]?.sender_id === message.sender_id;
    return renderTemplate`<div${addAttribute(`flex items-end ${isSender ? "justify-end" : "justify-start"} gap-1.5 sm:gap-2 ${isConsecutive ? "mt-1" : "mt-3"}`, "class")}${addAttribute(`message-${message.id}`, "id")} data-astro-cid-xbdigaai>  ${!isSender && showAvatar ? renderTemplate`<div class="w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-gray-200 flex-shrink-0 overflow-hidden mb-1" data-astro-cid-xbdigaai> ${otherUser?.avatarUrl ? renderTemplate`<img${addAttribute(otherUser.avatarUrl, "src")} alt="" class="w-full h-full object-cover" data-astro-cid-xbdigaai>` : renderTemplate`<div${addAttribute(`w-full h-full flex items-center justify-center ${isVolunteerChat ? "bg-secondary" : "bg-primary"} text-white text-sm`, "class")} data-astro-cid-xbdigaai> ${otherUser?.pseudo_utilisateur?.charAt(0) || "?"} </div>`} </div>` : !isSender && !showAvatar ? renderTemplate`<div class="w-7 sm:w-8 flex-shrink-0" data-astro-cid-xbdigaai></div>` : null} <div${addAttribute(`max-w-[80%] sm:max-w-[75%] px-3 py-2 rounded-lg ${isSender ? "bg-primary text-white rounded-br-none" : "bg-white text-gray-800 rounded-bl-none shadow-sm"} ${isConsecutive && !isSender ? "rounded-tl-sm" : ""} ${isConsecutive && isSender ? "rounded-tr-sm" : ""}`, "class")} data-astro-cid-xbdigaai> <p class="whitespace-pre-wrap break-words text-sm sm:text-base" data-astro-cid-xbdigaai>${message.content}</p> <p${addAttribute(`text-[10px] sm:text-xs mt-1 text-right ${isSender ? "text-primary-100" : "text-gray-500"}`, "class")} data-astro-cid-xbdigaai> ${messageTime} ${isSender && renderTemplate`<span class="ml-1"${addAttribute(message.read_by && message.read_by.length > 1 ? "Lu" : "Envoy\xE9", "title")} data-astro-cid-xbdigaai> ${message.read_by && message.read_by.length > 1 ? renderTemplate`<svg xmlns="http://www.w3.org/2000/svg" class="h-2.5 sm:h-3 w-2.5 sm:w-3 inline" viewBox="0 0 20 20" fill="currentColor" data-astro-cid-xbdigaai> <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" data-astro-cid-xbdigaai></path> </svg>` : renderTemplate`<svg xmlns="http://www.w3.org/2000/svg" class="h-2.5 sm:h-3 w-2.5 sm:w-3 inline opacity-70" viewBox="0 0 20 20" fill="currentColor" data-astro-cid-xbdigaai> <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" data-astro-cid-xbdigaai></path> </svg>`} </span>`} </p> </div> </div>`;
  })} <!-- Indicateur de défilement vers le bas --> <button id="scroll-bottom" class="hidden fixed bottom-20 right-4 sm:bottom-24 sm:right-8 bg-primary text-white p-2 rounded-full shadow-lg hover:bg-primary/90 transition z-20" data-astro-cid-xbdigaai> <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" data-astro-cid-xbdigaai> <path fill-rule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clip-rule="evenodd" data-astro-cid-xbdigaai></path> </svg> </button> </div> <div id="debug-controls" class="bg-gray-100 border-t border-b p-1 text-center hidden" data-astro-cid-xbdigaai> <button id="test-firebase" class="text-xs text-gray-500 hover:underline mx-2" data-astro-cid-xbdigaai>
Vérifier la connexion
</button> <button id="refresh-chat" class="text-xs text-gray-500 hover:underline mx-2" data-astro-cid-xbdigaai>
Rafraîchir les messages
</button> </div>  <div class="border-t bg-white p-2 sm:p-3 sticky bottom-0 z-10" data-astro-cid-xbdigaai> <form id="message-form" class="flex items-center gap-2" data-astro-cid-xbdigaai> <input type="hidden" name="conversationId"${addAttribute(conversationId, "value")} data-astro-cid-xbdigaai> <input type="hidden" id="current-user-id"${addAttribute(currentUserId, "value")} data-astro-cid-xbdigaai> <div class="flex-1 relative" data-astro-cid-xbdigaai> <input type="text" name="message" id="message-input" placeholder="Écrivez votre message..." class="w-full py-2 sm:py-3 px-4 bg-gray-100 border-0 rounded-full focus:outline-none focus:ring-2 focus:ring-primary/30 pr-10 text-sm sm:text-base" autocomplete="off" data-astro-cid-xbdigaai> <div class="absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1" data-astro-cid-xbdigaai> <button type="button" id="emoji-button" class="text-gray-500 hover:text-gray-700 p-1" data-astro-cid-xbdigaai> <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" data-astro-cid-xbdigaai> <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-7.536 5.879a1 1 0 001.415 0 3 3 0 014.242 0 1 1 0 001.415-1.415 5 5 0 00-7.072 0 1 1 0 000 1.415z" clip-rule="evenodd" data-astro-cid-xbdigaai></path> </svg> </button> </div> </div> <button type="submit" class="bg-primary text-white p-2 sm:p-3 rounded-full hover:bg-primary/90 transition focus:outline-none focus:ring-2 focus:ring-primary/50 flex-shrink-0" id="send-button" data-astro-cid-xbdigaai> <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" data-astro-cid-xbdigaai> <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" data-astro-cid-xbdigaai></path> </svg> </button> </form> </div> ` })}`} </div> ${renderScript($$result, "C:/Users/Utilisateur/GitHub/projet-co-s2-2025-17_echosafe/src/components/ChatConversation.astro?astro&type=script&index=0&lang.ts")} ${renderScript($$result, "C:/Users/Utilisateur/GitHub/projet-co-s2-2025-17_echosafe/src/components/ChatConversation.astro?astro&type=script&index=1&lang.ts")} `;
}, "C:/Users/Utilisateur/GitHub/projet-co-s2-2025-17_echosafe/src/components/ChatConversation.astro", void 0);

export { $$ChatConversation as $ };
